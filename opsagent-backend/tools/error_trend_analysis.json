{
  "id": "error_trend_analysis",
  "type": "esql",
  "description": "Analyze error rate trends over time buckets for a service to determine if the situation is improving, stable, or worsening. Computes error counts, total request counts, and error rate percentage per time bucket. Use this to assess incident trajectory and whether remediation actions are working.",
  "configuration": {
    "query": "FROM logs-opsagent-* | WHERE service.name == ?service_name AND @timestamp > NOW() - ?time_range | EVAL is_error = CASE(log.level IN (\"ERROR\", \"FATAL\"), 1, 0) | EVAL time_bucket = DATE_TRUNC(?bucket_size, @timestamp) | STATS error_count = SUM(is_error), total_count = COUNT(*) BY time_bucket | EVAL error_rate_pct = ROUND(error_count / total_count * 100, 2) | SORT time_bucket ASC | LIMIT 100",
    "params": {
      "service_name": {
        "type": "string",
        "description": "The name of the service to analyze error trends for (e.g., payment-service)"
      },
      "time_range": {
        "type": "string",
        "description": "Total time range to analyze, e.g. '6 hours', '1 day', '3 days'"
      },
      "bucket_size": {
        "type": "string",
        "description": "Time bucket granularity, e.g. '5 minutes', '15 minutes', '1 hour'"
      }
    }
  }
}
